<!DOCTYPE html>

<html>
<head>
  <title>Basic income and basic job models</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="basic-income-and-basic-job-models">Basic income and basic job models</h1>
<hr>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2 id="constants">Constants</h2>
<hr>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>From 2010 census</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> numAdults = <span class="hljs-number">227e6</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Minimum wage, 40 hours/week, 50 weeks/year</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> basicIncome = <span class="hljs-number">7.25</span> * <span class="hljs-number">40</span> * <span class="hljs-number">50</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Also from 2010</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> laborForce = <span class="hljs-number">154e6</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Also from 2010</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> disabledAdults = <span class="hljs-number">21e6</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Also from 2010, includes SS, Medicare, welfare, etc.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> currentWealthTransfers = <span class="hljs-number">3369e9</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h2 id="basic-income-model">Basic income model</h2>
<hr>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Each time this function is called, the model will be run once. Because there is randomness in the model, the output will vary. Later, this function will be run many times to assess the full range of possible outcomes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">basicIncomeCostBenefit</span>(<span class="hljs-params"></span>) </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>This object will store all the costs and benefits of the basic income as key/value pairs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> amounts = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Assume we have some kind of phase out, like with a negative income tax</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    amounts.directCosts = numAdults * basicIncome / <span class="hljs-number">2</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Small random administrative cost</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> administrativeCostPerPerson = gaussRand(<span class="hljs-number">250</span>, <span class="hljs-number">75</span>);
    amounts.administrativeCosts = numAdults * administrativeCostPerPerson;</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Will basic income increase the labor force or decrease it? Not sure</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> nonWorkerMultiplier = uniformRand(-<span class="hljs-number">0.10</span>, <span class="hljs-number">0.15</span>);
    <span class="hljs-keyword">var</span> nonWorkers = (numAdults - laborForce - disabledAdults) * (<span class="hljs-number">1</span> + nonWorkerMultiplier);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>How will basic income change the productivity of current workers?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> avgHourlyWage = <span class="hljs-number">25</span>;
    <span class="hljs-keyword">var</span> productivityMultiplier = uniformRand(-<span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span>);
    amounts.productivity = -laborForce * (<span class="hljs-number">40</span> * <span class="hljs-number">52</span> * avgHourlyWage) * productivityMultiplier;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Basic income will allow some small number of creative geniuses to maximize their talents</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    amounts.jkRowling = -binomRand(nonWorkers, <span class="hljs-number">1e-7</span>) * <span class="hljs-number">1e9</span>;

    <span class="hljs-keyword">return</span> amounts;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h2 id="basic-job-model">Basic job model</h2>
<hr>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Like the basic income model, this function will run the model once each time it is called. The output of this function is the same format as <code>basicIncomeCostBenefit</code>, so the results can be easily compared.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">basicJobCostBenefit</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> amounts = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Will basic job increase the labor force or decrease it? Not sure</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> nonWorkerMultiplier = uniformRand(-<span class="hljs-number">0.1</span>, <span class="hljs-number">0.15</span>);
    <span class="hljs-keyword">var</span> numBasicWorkers = (numAdults - disabledAdults - laborForce) * (<span class="hljs-number">1</span> + nonWorkerMultiplier);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Overall direct costs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    amounts.directCosts = numBasicWorkers * basicIncome;</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Some cost for disabled people who can’t work</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> administrativeCostPerDisabledPerson = gaussRand(<span class="hljs-number">500</span>, <span class="hljs-number">150</span>);
    amounts.disabled = disabledAdults * (basicIncome + administrativeCostPerDisabledPerson);</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Some cost to run the program</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> administrativeCostPerWorker = gaussRand(<span class="hljs-number">5000</span>, <span class="hljs-number">1500</span>);
    amounts.administrativeCosts = numBasicWorkers * administrativeCostPerWorker;</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Can productive work actually be done in this scheme?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> basicJobHourlyProductivity = uniformRand(-<span class="hljs-number">7.25</span>, <span class="hljs-number">7.25</span>);
    amounts.productivity = -numBasicWorkers * (<span class="hljs-number">40</span> * <span class="hljs-number">50</span> * basicJobHourlyProductivity);

    <span class="hljs-keyword">return</span> amounts;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h2 id="run-models-and-aggregate-results">Run models and aggregate results</h2>
<hr>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">var</span> biAmounts = [];
<span class="hljs-keyword">var</span> biTotals = [];
<span class="hljs-keyword">var</span> bjAmounts = [];
<span class="hljs-keyword">var</span> bjTotals = [];
<span class="hljs-keyword">var</span> biAmountsAvg;
<span class="hljs-keyword">var</span> bjAmountsAvg;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">run</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> N = <span class="hljs-number">1000</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; N; i++) {
        biAmounts[i] = basicIncomeCostBenefit();
        biTotals[i] = <span class="hljs-built_in">Object</span>.keys(biAmounts[i]).reduce(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">total, key</span>) </span>{
            <span class="hljs-keyword">return</span> biAmounts[i][key] / <span class="hljs-number">1e12</span> + total;
        }, <span class="hljs-number">0</span>);

        bjAmounts[i] = basicJobCostBenefit();
        bjTotals[i] = <span class="hljs-built_in">Object</span>.keys(bjAmounts[i]).reduce(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">total, key</span>) </span>{
            <span class="hljs-keyword">return</span> bjAmounts[i][key] / <span class="hljs-number">1e12</span> + total;
        }, <span class="hljs-number">0</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">amountsAvgReducer</span>(<span class="hljs-params">avg, amounts</span>) </span>{
        <span class="hljs-built_in">Object</span>.keys(amounts).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">key</span>) </span>{
            <span class="hljs-keyword">if</span> (avg.hasOwnProperty(key)) {
                avg[key] += amounts[key] / N;
            } <span class="hljs-keyword">else</span> {
                avg[key] = amounts[key] / N;
            }
        });

        <span class="hljs-keyword">return</span> avg;
    }

    biAmountsAvg = biAmounts.reduce(amountsAvgReducer, {});
    bjAmountsAvg = bjAmounts.reduce(amountsAvgReducer, {});

    render();
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params"></span>) </span>{
    bars(<span class="hljs-string">'biBars'</span>, biAmountsAvg, bjAmountsAvg);
    bars(<span class="hljs-string">'bjBars'</span>, bjAmountsAvg, biAmountsAvg);

    histogram(<span class="hljs-string">'biHist'</span>, biTotals);
    histogram(<span class="hljs-string">'bjHist'</span>, bjTotals);
}

run();</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>The histograms need to be re-rendered when the size of the window changes, otherwise they won’t fit in the window correctly</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">window</span>.addEventListener(<span class="hljs-string">'resize'</span>, render);</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h2 id="display-results">Display results</h2>
<hr>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Plot one of the histograms, showing the distribution of possible costs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">histogram</span>(<span class="hljs-params">containerId, values</span>) </span>{
    <span class="hljs-keyword">var</span> container = <span class="hljs-built_in">document</span>.getElementById(containerId);
    container.innerHTML = <span class="hljs-string">''</span>;

    <span class="hljs-keyword">var</span> margin = {top: <span class="hljs-number">10</span>, right: <span class="hljs-number">30</span>, bottom: <span class="hljs-number">45</span>, left: <span class="hljs-number">30</span>},
        width = container.offsetWidth - margin.left - margin.right,
        height = <span class="hljs-number">200</span> - margin.top - margin.bottom;

    <span class="hljs-keyword">var</span> x = d3.scale.linear()
        .domain([<span class="hljs-number">0</span>, <span class="hljs-number">4</span>])
        .range([<span class="hljs-number">0</span>, width]);</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Generate a histogram with 10 evenly-spaced bins from input values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> data = d3.layout.histogram()
        .bins(x.ticks(<span class="hljs-number">10</span>))(values);

    <span class="hljs-keyword">var</span> y = d3.scale.linear()
        .domain([<span class="hljs-number">0</span>, d3.max(data, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.y; })])
        .range([height, <span class="hljs-number">0</span>]);

    <span class="hljs-keyword">var</span> xAxis = d3.svg.axis()
        .scale(x)
        .orient(<span class="hljs-string">'bottom'</span>);

    <span class="hljs-keyword">var</span> svg = d3.select(<span class="hljs-string">'#'</span> + containerId).append(<span class="hljs-string">'svg'</span>)
        .attr(<span class="hljs-string">'width'</span>, width + margin.left + margin.right)
        .attr(<span class="hljs-string">'height'</span>, height + margin.top + margin.bottom)
        .append(<span class="hljs-string">'g'</span>)
        .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'translate('</span> + margin.left + <span class="hljs-string">','</span> + margin.top + <span class="hljs-string">')'</span>);

    <span class="hljs-keyword">var</span> bar = svg.selectAll(<span class="hljs-string">'.bar'</span>)
        .data(data)
        .enter().append(<span class="hljs-string">'g'</span>)
        .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'bar'</span>)
        .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">'translate('</span> + x(d.x) + <span class="hljs-string">','</span> + y(d.y) + <span class="hljs-string">')'</span>; });

    bar.append(<span class="hljs-string">'rect'</span>)
        .attr(<span class="hljs-string">'x'</span>, <span class="hljs-number">1</span>)
        .attr(<span class="hljs-string">'width'</span>, x(data[<span class="hljs-number">0</span>].dx) - <span class="hljs-number">1</span>)
        .attr(<span class="hljs-string">'height'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> height - y(d.y); });

    svg.append(<span class="hljs-string">'g'</span>)
        .attr(<span class="hljs-string">'class'</span>, <span class="hljs-string">'x axis'</span>)
        .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'translate(0,'</span> + height + <span class="hljs-string">')'</span>)
        .call(xAxis);

    svg.append(<span class="hljs-string">'text'</span>)
        .attr(<span class="hljs-string">'transform'</span>, <span class="hljs-string">'translate('</span> + (width / <span class="hljs-number">2</span>) + <span class="hljs-string">' ,'</span> + (height + margin.bottom - <span class="hljs-number">5</span>) + <span class="hljs-string">')'</span>)
        .style(<span class="hljs-string">'text-anchor'</span>, <span class="hljs-string">'middle'</span>)
        .text(<span class="hljs-string">'Cost (trillions of dollars)'</span>);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Plot one of the bar graphs, showing the average contribution of different components to the total cost</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bars</span>(<span class="hljs-params">containerId, amounts, amounts2</span>) </span>{
    <span class="hljs-keyword">var</span> container = <span class="hljs-built_in">document</span>.getElementById(containerId);
    container.innerHTML = <span class="hljs-string">''</span>;

    <span class="hljs-keyword">var</span> width = <span class="hljs-number">100</span>;

    <span class="hljs-keyword">var</span> categories = <span class="hljs-built_in">Object</span>.keys(amounts).sort();
    <span class="hljs-keyword">var</span> values = categories.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">category</span>) </span>{
        <span class="hljs-keyword">return</span> amounts[category];
    });

    <span class="hljs-keyword">var</span> categories2 = <span class="hljs-built_in">Object</span>.keys(amounts2).sort();
    <span class="hljs-keyword">var</span> values2 = categories2.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">category</span>) </span>{
        <span class="hljs-keyword">return</span> amounts2[category];
    });

    <span class="hljs-keyword">var</span> maxValue = <span class="hljs-built_in">Math</span>.max.apply(<span class="hljs-built_in">Math</span>, values.concat(values2));
    <span class="hljs-keyword">var</span> minValue = <span class="hljs-built_in">Math</span>.min.apply(<span class="hljs-built_in">Math</span>, values.concat(values2));

    <span class="hljs-keyword">var</span> zero;
    <span class="hljs-keyword">if</span> (minValue &gt; <span class="hljs-number">0</span> || maxValue &lt; <span class="hljs-number">0</span>) {
        zero = <span class="hljs-number">0</span>;
    } <span class="hljs-keyword">else</span> {
        zero = -minValue * <span class="hljs-number">100</span> / (maxValue - minValue);
    }

    <span class="hljs-keyword">var</span> data = [];
    values.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value, i</span>) </span>{
        <span class="hljs-keyword">var</span> scaled = value * <span class="hljs-number">100</span> / (maxValue - minValue);
        <span class="hljs-keyword">var</span> width = <span class="hljs-built_in">Math</span>.abs(scaled);
        <span class="hljs-keyword">var</span> sign = <span class="hljs-built_in">Math</span>.sign(scaled);

        data.push({
            value: value,
            offset: sign === <span class="hljs-number">1</span> ? zero : zero + scaled,
            width: width,
            sign: sign,
            category: categories[i]
        });
    });

    <span class="hljs-keyword">var</span> div = d3.select(<span class="hljs-string">'#tooltip'</span>)
        .style(<span class="hljs-string">'opacity'</span>, <span class="hljs-number">0</span>);

    <span class="hljs-keyword">var</span> rows = d3.select(<span class="hljs-string">'#'</span> + containerId)
        .selectAll(<span class="hljs-string">'table'</span>)
        .data(data)
        .enter().append(<span class="hljs-string">'tr'</span>);

    rows.append(<span class="hljs-string">'td'</span>)
        .html(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.category; });

    rows.append(<span class="hljs-string">'td'</span>)
        .on(<span class="hljs-string">'mouseover'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{
            div.style(<span class="hljs-string">'opacity'</span>, <span class="hljs-number">0.9</span>);
            div.html(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> (d.sign === <span class="hljs-number">1</span>) {
                        <span class="hljs-keyword">return</span> <span class="hljs-string">'Costs $'</span> + (d.value / <span class="hljs-number">1e12</span>).toFixed(<span class="hljs-number">2</span>) + <span class="hljs-string">' trillion'</span>;
                    }
                    <span class="hljs-keyword">return</span> <span class="hljs-string">'Reduces costs $'</span> + (-d.value / <span class="hljs-number">1e12</span>).toFixed(<span class="hljs-number">2</span>) + <span class="hljs-string">' trillion'</span>;
                })
               .style(<span class="hljs-string">'left'</span>, (d3.event.pageX + <span class="hljs-number">15</span>) + <span class="hljs-string">'px'</span>)
               .style(<span class="hljs-string">'top'</span>, (d3.event.pageY) + <span class="hljs-string">'px'</span>);
        })
        .on(<span class="hljs-string">'mouseout'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{
            div.style(<span class="hljs-string">'opacity'</span>, <span class="hljs-number">0</span>);
        })
        .append(<span class="hljs-string">'div'</span>)
        .style(<span class="hljs-string">'width'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.width + <span class="hljs-string">'px'</span>; })
        .style(<span class="hljs-string">'height'</span>, <span class="hljs-string">'1em'</span>)
        .style(<span class="hljs-string">'margin-left'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.offset + <span class="hljs-string">'px'</span>; })
        .style(<span class="hljs-string">'background-color'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">d</span>) </span>{ <span class="hljs-keyword">return</span> d.sign === <span class="hljs-number">1</span> ? <span class="hljs-string">'red'</span> : <span class="hljs-string">'black'</span>; });
}</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <h2 id="utility-functions">Utility functions</h2>
<hr>

            </div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Because JavaScript’s ecosystem is a wasteland, I wrote some helper functions for generating the random numbers used in the models</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uniformRand</span>(<span class="hljs-params">min, max</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.random() * (max - min) + min;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">gaussRand</span>(<span class="hljs-params">mu, sigma</span>) </span>{
    <span class="hljs-keyword">var</span> marsaglia, radius, z1, z2;

    mu = mu !== <span class="hljs-literal">undefined</span> ? mu : <span class="hljs-number">0</span>;
    sigma = sigma !== <span class="hljs-literal">undefined</span> ? sigma : <span class="hljs-number">1</span>;

    <span class="hljs-keyword">do</span> {
        z1 = <span class="hljs-number">2</span> * <span class="hljs-built_in">Math</span>.random() - <span class="hljs-number">1</span>;
        z2 = <span class="hljs-number">2</span> * <span class="hljs-built_in">Math</span>.random() - <span class="hljs-number">1</span>;
        radius = z1 * z1 + z2 * z2;
    } <span class="hljs-keyword">while</span> (radius &gt;= <span class="hljs-number">1</span> || radius === <span class="hljs-number">0</span>);

    marsaglia = <span class="hljs-built_in">Math</span>.sqrt(-<span class="hljs-number">2</span> * <span class="hljs-built_in">Math</span>.log(radius) / radius);

    <span class="hljs-keyword">return</span> (z1 * marsaglia) * sigma + mu;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">binomRand</span>(<span class="hljs-params">N, p</span>) </span>{
    <span class="hljs-keyword">var</span> count = <span class="hljs-built_in">Math</span>.round(gaussRand(N * p, <span class="hljs-built_in">Math</span>.sqrt(N * p * (<span class="hljs-number">1</span> - p))));
    <span class="hljs-keyword">return</span> count &gt; <span class="hljs-number">0</span> ? count : <span class="hljs-number">0</span>;
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
